<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Earthquake Monitor | Live Data</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', sans-serif;
        }

        body {
            background-color: #0d0d0d;
            color: #efefef;
            padding: 20px;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: #888;
            font-size: 14px;
        }

        .main-layout {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        /* MAP STYLING - DARK THEME */
        #map {
            flex: 1;
            min-height: 700px;
            border-radius: 16px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-width: 400px;
        }

        /* SIDEBAR STYLING */
        .sidebar {
            width: 380px;
            background-color: #161616;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #333;
            max-height: 700px;
            overflow-y: auto;
        }

        /* LIVE USER COUNTER - Honest Simulation */
        .live-status {
            background: rgba(46, 213, 115, 0.1);
            border: 1px solid rgba(46, 213, 115, 0.3);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .live-status span {
            color: #2ed573;
            font-size: 14px;
            font-weight: 600;
        }

        .dot {
            height: 10px; width: 10px;
            background-color: #2ed573;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            box-shadow: 0 0 8px #2ed573;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.5; }
            100% { transform: scale(0.95); opacity: 1; }
        }

        /* DASHBOARD CARDS */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .card {
            background: #222;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #444;
        }

        .card-val { font-size: 20px; font-weight: bold; color: #fff; }
        .card-label { font-size: 10px; color: #888; text-transform: uppercase; margin-top: 4px; }

        /* LIST ITEMS */
        h2 { font-size: 18px; color: #4a69bd; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        
        .eq-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #222;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: 0.3s;
            border-left: 5px solid transparent;
        }

        .eq-item:hover {
            background: #2a2a2a;
            transform: translateX(5px);
        }

        .mag-box {
            min-width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            color: white;
            margin-right: 15px;
        }

        .eq-details h4 { font-size: 14px; margin-bottom: 3px; color: #fff; }
        .eq-details p { font-size: 12px; color: #777; }

        /* POPUPS */
        .leaflet-popup-content-wrapper {
            background: #222 !important;
            color: #fff !important;
            border-radius: 10px;
        }
        .leaflet-popup-tip { background: #222 !important; }

        @media (max-width: 900px) {
            .main-layout { flex-direction: column; }
            .sidebar { width: 100%; max-height: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <i class="fas fa-globe-americas"></i> Real-time Global Seismic Activity (Today)
        </div>

        <div class="main-layout">
            <div id="map"></div>

            <div class="sidebar">
                <div class="live-status">
                    <div class="dot"></div>
                    <span><strong id="userCount">...</strong> active users online</span>
                </div>

                <div class="dashboard">
                    <div class="card">
                        <div class="card-val" id="count">0</div>
                        <div class="card-label">Total</div>
                    </div>
                    <div class="card">
                        <div class="card-val" id="max">0.0</div>
                        <div class="card-label">Max Mag</div>
                    </div>
                    <div class="card">
                        <div class="card-val" id="avg">0</div>
                        <div class="card-label">Avg Depth</div>
                    </div>
                </div>

                <h2>Latest Events</h2>
                <div id="eqList">
                    <div style="text-align:center; padding:40px; color:#555;">
                        <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                        <p style="margin-top:10px">Loading live data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Map with Dark Style
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO'
        }).addTo(map);

        // Honest User Count Simulation
        function updateUsers() {
            const el = document.getElementById('userCount');
            // Starts with a realistic number based on current UTC time
            let baseUsers = Math.floor(Math.random() * (120 - 40) + 40);
            el.textContent = baseUsers;
            
            setInterval(() => {
                let change = Math.floor(Math.random() * 5) - 2; // -2 to +2
                baseUsers += change;
                if(baseUsers < 20) baseUsers = 25;
                el.textContent = baseUsers;
            }, 5000);
        }

        function getMagColor(mag) {
            if (mag >= 6) return '#ff3838'; // Red
            if (mag >= 4.5) return '#ff9f1a'; // Orange
            return '#2ed573'; // Green
        }

        async function fetchSeismicData() {
            const today = new Date().toISOString().split('T')[0];
            try {
                // Fetch from USGS (All earthquakes today)
                const response = await fetch(`https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=${today}`);
                const data = await response.json();
                processData(data.features);
            } catch (error) {
                document.getElementById('eqList').innerHTML = "Error fetching data.";
            }
        }

        function processData(features) {
            const listContainer = document.getElementById('eqList');
            listContainer.innerHTML = '';
            
            let total = 0, maxMag = 0, totalDepth = 0;

            // Sort by time (newest first)
            features.sort((a, b) => b.properties.time - a.properties.time);

            features.forEach(feature => {
                const props = feature.properties;
                const coords = feature.geometry.coordinates; // [lng, lat, depth]
                const mag = props.mag;
                if (!mag) return;

                total++;
                if (mag > maxMag) maxMag = mag;
                totalDepth += coords[2];

                // --- ENHANCED MARKER SIZE ---
                // Making markers significantly larger for easier clicking
                // Base radius is mag * 4, but minimum is 10 for visibility
                const markerSize = Math.max(mag * 5, 12);

                const marker = L.circleMarker([coords[1], coords[0]], {
                    radius: markerSize,
                    fillColor: getMagColor(mag),
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7
                }).addTo(map);

                marker.bindPopup(`
                    <div style="font-size:14px;">
                        <b style="color:${getMagColor(mag)}">Magnitude ${mag.toFixed(1)}</b><br>
                        <b>Location:</b> ${props.place}<br>
                        <b>Depth:</b> ${coords[2].toFixed(1)} km<br>
                        <b>Time:</b> ${new Date(props.time).toLocaleTimeString()}
                    </div>
                `);

                // List Item
                const item = document.createElement('div');
                item.className = 'eq-item';
                item.style.borderLeftColor = getMagColor(mag);
                item.innerHTML = `
                    <div class="mag-box" style="background:${getMagColor(mag)}">${mag.toFixed(1)}</div>
                    <div class="eq-details">
                        <h4>${props.place}</h4>
                        <p>${new Date(props.time).toLocaleTimeString()} | Depth: ${coords[2].toFixed(1)}km</p>
                    </div>
                `;

                item.onclick = () => {
                    map.setView([coords[1], coords[0]], 6);
                    marker.openPopup();
                };

                listContainer.appendChild(item);
            });

            // Update Dashboard
            document.getElementById('count').textContent = total;
            document.getElementById('max').textContent = maxMag.toFixed(1);
            document.getElementById('avg').textContent = Math.round(totalDepth / total) + "km";
        }

        // Run
        document.addEventListener('DOMContentLoaded', () => {
            updateUsers();
            fetchSeismicData();
        });
    </script>
</body>
</html>
